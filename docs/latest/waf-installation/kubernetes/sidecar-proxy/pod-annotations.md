# Supported per-pod's annotation

The [Wallarm Sidecar proxy solution 2.0] can be configured via annotations on the per-pod's basis. The list of annotations supported in this solution are described in this document.

examples on how to add annotation via cli and config?

All annotations below are specified without prefix `sidecar.wallarm.io/`, to use them properly just add this prefix, e.g. `sidecar.wallarm.io/wallarm-mode`

*NOTE*: annotations take precedence over Helm chart values.

| Annotation                          | Chart value                                                      | Description                                                                                                                                                                                                                                                                                                        |
|-------------------------------------|------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| sidecar-injection-schema            | config.injectionStrategy.schema                                  | Sidecar deployment schema: `single` or `split`                                                                                                                                                                                                                                                                     |
| sidecar-injection-iptables-enable   | config.injectionStrategy.iptablesEnable                          | Enable or disable `iptables` init container for port redirection: `true` or `false`                                                                                                                                                                                                                                |
| wallarm-application                 | NA                                                               | The ID of Wallarm application (optional)                                                                                                                                                                                                                                                                           |
| wallarm-block-page                  | NA                                                               | Lets you set up the response to the blocked request. Example: `&/usr/share/nginx/html/wallarm_blocked.html response_code=403 type=attack,acl_ip,acl_source`                                                                                                                                                        |
| wallarm-enable-libdetection         | config.wallarm.enableLibDetection                                | Enables additional validation of the SQL Injection attacks via the libdetection library: `on` or `off`                                                                                                                                                                                                             |
| wallarm-fallback                    | config.wallarm.fallback                                          | Fallback mode: `on` or  `off`. With the value set to on, NGINX has the ability to enter an emergency mode; if proton.db or custom ruleset cannot be downloaded, this setting disables the Wallarm module for the http, server, and location blocks, for which the data fails to download. NGINX keeps functioning. |
| wallarm-mode                        | config.wallarm.mode                                              | Wallarm mode: `monitoring`, `block` or `off`                                                                                                                                                                                                                                                                       |
| wallarm-mode-allow-override         | config.wallarm.modeAllowOverride                                 | Manages the ability to override the wallarm_mode values via filtering in the Cloud (custom ruleset): `on`, `off` or `strict`                                                                                                                                                                                       |
| wallarm-parser-disable              | NA                                                               | Allows to disable parsers. The directive values corresponds to the name of the parser to be disabled, e.g. `json`. Multiple parser can be specified, dividing by semicolon, e.g. `json;base64`                                                                                                                     |
| wallarm-parse-response              | config.wallarm.parseResponse                                     | Whether to analyze the application responses for attacks: `on` or `off`                                                                                                                                                                                                                                            |
| wallarm-parse-websocket             | config.wallarm.parseWebsocket                                    | Whether to analyze WebSocket's messages for attacks: `on` or `off`                                                                                                                                                                                                                                                 |
| wallarm-unpack-response             | config.wallarm.unpackResponse                                    | Whether to decompress compressed data returned in the application response: `on` or `off`                                                                                                                                                                                                                          |
| wallarm-upstream-connect-attempts   | config.wallarm.upstream.connectAttempts                          | Defines the number of immediate reconnects to the Tarantool or Wallarm API                                                                                                                                                                                                                                         |
| wallarm-upstream-reconnect-interval | config.wallarm.upstream.reconnectInterval                        | Defines the interval between attempts to reconnect to the Tarantool or Wallarm API                                                                                                                                                                                                                                 |
| application-port                    | config.nginx.applicationPort                                     | Port listening by application container. This port is used as application container port, if pod has no exposed ports for application container. Refer `Application container port auto-discovery` section for details                                                                                             |
| nginx-listen-port                   | config.nginx.listenPort                                          | Port listening by sidecar proxy container. This port is reserved for using by Wallarm sidecar, can't be the same as `config.nginx.applicationPort`                                                                                                                                                                 |
| nginx-http-include                  | NA                                                               | JSON list of full paths to additional config files which should be included on `http` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                            |
| nginx-http-snippet                  | NA                                                               | Additional inline config which should be included on `http` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                                                      |
| nginx-server-include                | NA                                                               | JSON list of full paths to additional config files which should be included on `server` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                          |                                                                                                                                                                                                        |
| nginx-server-snippet                | NA                                                               | Additional inline config which should be included on `server` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                                                    |
| nginx-location-include              | NA                                                               | JSON list of full paths to additional config files which should be included on `location` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                        |                                                                                                                                                                                                         |
| nginx-location-snippet              | NA                                                               | Additional inline config which should be included on `location` level of NGINX configuration. Refer "Using additional user provided Nginx configuration" section for more details                                                                                                                                  |
| nginx-extra-modules                 | NA                                                               | JSON list of NGINX modules to enable. Refer "Enable additional Nginx modules" section for details                                                                                                                                                                                                                  |
| proxy-extra-volumes                 | NA                                                               | User volumes to be added to the Pod (JSON object). Example: `"[{'name':'volumeName','configMap':{'name':'someConfigMapName'}}]"`                                                                                                                                                                                   |
| proxy-extra-volume-mounts           | NA                                                               | User volume mounts to be added to the `proxy` container (JSON object). Example:`"[{'name':'volumeName','mountPath':'/some/thing'}]"`                                                                                                                                                                               |
| proxy-cpu                           | config.sidecar.containers.proxy.resources.requests.cpu           | Requested CPU for `proxy` container                                                                                                                                                                                                                                                                                |
| proxy-memory                        | config.sidecar.containers.proxy.resources.requests.memory        | Requested memory for `proxy` container                                                                                                                                                                                                                                                                             |
| proxy-cpu-limit                     | config.sidecar.containers.proxy.resources.limits.cpu             | CPU limit for `proxy` container                                                                                                                                                                                                                                                                                    |
| proxy-memory-limit                  | config.sidecar.containers.proxy.resources.limits.memory          | Memory limit for `proxy` container                                                                                                                                                                                                                                                                                 |
| helper-cpu                          | config.sidecar.containers.helper.resources.requests.cpu          | Requested CPU for `helper` container                                                                                                                                                                                                                                                                               |
| helper-memory                       | config.sidecar.containers.helper.resources.requests.memory       | Requested memory for `helper` container                                                                                                                                                                                                                                                                            |
| helper-cpu-limit                    | config.sidecar.containers.helper.resources.limits.cpu            | CPU limit for `helper` container                                                                                                                                                                                                                                                                                   |
| helper-memory-limit                 | config.sidecar.containers.helper.resources.limits.memory         | Memory limit for `helper` container                                                                                                                                                                                                                                                                                |
| init-iptables-cpu                   | config.sidecar.initContainers.iptables.resources.requests.cpu    | Requested CPU for `init-iptables` container                                                                                                                                                                                                                                                                        |
| init-iptables-memory                | config.sidecar.initContainers.iptables.resources.requests.memory | Requested memory for `init-iptables` container                                                                                                                                                                                                                                                                     |
| init-iptables-cpu-limit             | config.sidecar.initContainers.iptables.resources.limits.cpu      | CPU limit for `init-iptables` container                                                                                                                                                                                                                                                                            |
| init-iptables-memory-limit          | config.sidecar.initContainers.iptables.resources.limits.memory   | Memory limit for `init-iptables` container                                                                                                                                                                                                                                                                         |
| init-helper-cpu                     | config.sidecar.initContainers.helper.resources.requests.cpu      | Requested CPU for `init-helper` container                                                                                                                                                                                                                                                                          |
| init-helper-memory                  | config.sidecar.initContainers.helper.resources.requests.memory   | Requested memory for `init-helper` container                                                                                                                                                                                                                                                                       |
| init-helper-cpu-limit               | config.sidecar.initContainers.helper.resources.limits.cpu        | CPU limit for `init-helper` container                                                                                                                                                                                                                                                                              |
| init-helper-memory-limit            | config.sidecar.initContainers.helper.resources.limits.memory     | Memory limit for `init-helper` container                                                                                                                                                                                                                                                                           |



## Supported Wallarm directives
Below is the table with the list of supported Wallarm directives. Most of them can be configured either globally using Helm chart values
or on per-pod basis using Pod's annotations. Those Wallarm directives which are not in the list can be configured by providing custom
Nginx configuration - refer section `Using additional user provided Nginx configuration` below in this document.

Note: some directives such as `wallarm_application`, `wallarm_block_page` and `wallarm_parser_disable` can be configured only by Pod's annotations.  

| Directive                           | Globally | Annotations |
|-------------------------------------|----------|-------------|
| wallarm_application                 | NO       | YES         |
| wallarm_block_page                  | NO       | YES         |
| wallarm_enable_libdetection         | YES      | YES         |
| wallarm_fallback                    | YES      | YES         |
| wallarm_mode                        | YES      | YES         |
| wallarm_mode_allow_override         | YES      | YES         |
| wallarm_parser_disable              | NO       | YES         |
| wallarm_parse_response              | YES      | YES         |
| wallarm_parse_websocket             | YES      | YES         |
| wallarm_unpack_response             | YES      | YES         |
| wallarm_upstream_connect_attempts   | YES      | YES         |
| wallarm_upstream_reconnect_interval | YES      | YES         |



as for other NGINX Wallarm settings - learn and mount if needed