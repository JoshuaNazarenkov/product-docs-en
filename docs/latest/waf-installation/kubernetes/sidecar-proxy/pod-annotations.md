# Supported per-pod's annotation

The [Wallarm Sidecar proxy solution 2.0](deployment.md) can be configured via annotations on the per-pod's basis. The list of annotations supported in this solution are described in this document.

!!! info "Priorities of global and per-pod's settings"
    Per-pod's annotations [take precedence](customization.md#configuration-area) over Helm chart values.

Before using an annotation, please add the `sidecar.wallarm.io/` prefix to it, e.g.:

```bash
sidecar.wallarm.io/wallarm-mode
```

## Annotation list

| Annotation                          | Chart value                                                      | Description                                                                                                                                                                                                                                                                                                        |
|-------------------------------------|------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| sidecar-injection-schema            | config.injectionStrategy.schema                                  | [Pattern of Wallarm container deployment](customization.md#single-and-split-deployment-of-containers): `single` (default) or `split`.                                                                                                                                                                                                                                                                     |
| sidecar-injection-iptables-enable   | config.injectionStrategy.iptablesEnable                          | [Whether to start the `iptables` init container](customization.md#incoming-traffic-interception-port-redirection): `true` (default) or `false`.                                                                                                                                                                                                                                |
| wallarm-application                 | NA                                                               | [Wallarm application ID](../../../user-guides/settings/applications.md).                                                                                                                                                                                                                                                                           |
| wallarm-block-page                  | NA                                                               | [Blocking page and error code](../../../admin-en/configuration-guides/configure-block-page-and-code.md) to return to blocked requests.                                                                                                                                                        |
| wallarm-enable-libdetection         | config.wallarm.enableLibDetection                                | Whether to additionally validate of the SQL Injection attacks using the [libdetection](../../../about-wallarm-waf/protecting-against-attacks.md#libdetection-overview) library: `on` or `off` (default).                                                                                                                                                                                                             |
| wallarm-fallback                    | config.wallarm.fallback                                          | [Wallarm fallback mode](../../../admin-en/configure-parameters-en.md#wallarm_fallback): `on` or  `off` (default). |
| wallarm-mode                        | config.wallarm.mode                                              | [Traffic filtration mode](../../../admin-en/configure-wallarm-mode.md): `monitoring` (default), `safe_blocking`, `block` or `off`.                                                                                                                                                                                                                                                                       |
| wallarm-mode-allow-override         | config.wallarm.modeAllowOverride                                 | Manages the [ability to override the `wallarm_mode` values via settings in the Cloud](../../../admin-en/configure-wallarm-mode.md#setting-up-priorities-of-the-filtration-mode-configuration-methods-using-wallarm_mode_allow_override): `on` (default), `off` or `strict`.                                                                                                                                                                                       |
| wallarm-parser-disable              | NA                                                               | Allows to disable [parsers](../../../user-guides/rules/request-processing.md). The directive values corresponds to the name of the parser to be disabled, e.g. `json`. Multiple parser can be specified, dividing by semicolon, e.g. `json;base64`.                                                                                                                     |
| wallarm-parse-response              | config.wallarm.parseResponse                                     | Whether to analyze the application responses for attacks: `on` (default) or `off`. Response analysis is required for vulnerability detection during [passive detection](../../../about-wallarm-waf/detecting-vulnerabilities.md#passive-detection) and [active threat verification](../../../about-wallarm-waf/detecting-vulnerabilities.md#active-threat-verification).                                                                                                                                                                                                                                            |
| wallarm-parse-websocket             | config.wallarm.parseWebsocket                                    | Wallarm has full WebSockets support. By default, the WebSockets' messages are not analyzed for attacks. To force the feature, use this annotation: `on` or `off` (default).                                                                                                                                                                                                                                                 |
| wallarm-unpack-response             | config.wallarm.unpackResponse                                    | Whether to decompress compressed data returned in the application response: `on` (default) or `off`.                                                                                                                                                                                                                          |
| wallarm-upstream-connect-attempts   | config.wallarm.upstream.connectAttempts                          | Defines the number of immediate reconnects to Tarantool or Wallarm API.                                                                                                                                                                                                                                         |
| wallarm-upstream-reconnect-interval | config.wallarm.upstream.reconnectInterval                        | Defines the interval between attempts to reconnect to Tarantool or Wallarm API after the number of unsuccessful attempts has exceeded the `wallarm-upstream-connect-attempts` threshold.                                                                                                                                                                                                                                |
| application-port                    | config.nginx.applicationPort                                     | Port listed by the Wallarm container. This port is used as a protected application container port, if [no exposed application pod ports were found](customization.md#application-container-port-auto-discovery).                                                                                             |
| nginx-listen-port                   | config.nginx.listenPort                                          | Port listed by the Wallarm container. This port is reserved for using by the Wallarm sidecar solution, can't be the same as `config.nginx.applicationPort`.                                                                                                                                                                 |
| nginx-http-include                  | NA                                                               | [JSON array of full paths to additional config](customization.md#using-custom-nginx-configuration) files that should be included on `http` level of NGINX configuration.                                                                                                            |
| nginx-http-snippet                  | NA                                                               | [Additional inline config](customization.md#using-custom-nginx-configuration) that should be included on the `http` level of NGINX configuration.                                                                                                                                      |
| nginx-server-include                  | NA                                                               | [JSON array of full paths to additional config](customization.md#using-custom-nginx-configuration) files that should be included on the `server` level of NGINX configuration.                                                                                                            |
| nginx-server-snippet                  | NA                                                               | [Additional inline config](customization.md#using-custom-nginx-configuration) that should be included on the `server` level of NGINX configuration.                                                                                                                                      |
| nginx-location-include                  | NA                                                               | [JSON array of full paths to additional config](customization.md#using-custom-nginx-configuration) files that should be included on `location` level of NGINX configuration.                                                                                                            |
| nginx-location-snippet                  | NA                                                               | [Additional inline config](customization.md#using-custom-nginx-configuration) that should be included on the `location` level of NGINX configuration.                                                                                                                                      |
| nginx-extra-modules                 | NA                                                               | JSON array of [additional NGINX modules](customization.md#enabling-additional-nginx-modules) to be enabled.                                                                                                                                                                                                                  |
| proxy-extra-volumes                 | NA                                                               | [Custom volumes](customization.md#include) to be added to the Pod (JSON object)                                                                                                                                                                                   |
| proxy-extra-volume-mounts           | NA                                                               | [Custom volume mounts](customization.md#include) to be added to the `sidecar-proxy` container (JSON object).                                                                                                                                                                               |
| proxy-cpu                           | config.sidecar.containers.proxy.resources.requests.cpu           | [Requested CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-proxy` container.                                                                                                                                                                                                                                                                                |
| proxy-memory                        | config.sidecar.containers.proxy.resources.requests.memory        | [Requested memory](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-proxy` container                                                                                                                                                                                                                                                                             |
| proxy-cpu-limit                     | config.sidecar.containers.proxy.resources.limits.cpu             | [CPU limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-proxy` container.                                                                                                                                                                                                                                                                                    |
| proxy-memory-limit                  | config.sidecar.containers.proxy.resources.limits.memory          | [Memory limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-proxy` container.                                                                                                                                                                                                                                                                                 |
| helper-cpu                          | config.sidecar.containers.helper.resources.requests.cpu          | [Requested CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-helper` container.                                                                                                                                                                                                                                                                               |
| helper-memory                       | config.sidecar.containers.helper.resources.requests.memory       | [Requested memory](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-helper` container.                                                                                                                                                                                                                                                                            |
| helper-cpu-limit                    | config.sidecar.containers.helper.resources.limits.cpu            | [CPU limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-helper` container.                                                                                                                                                                                                                                                                                  |
| helper-memory-limit                 | config.sidecar.containers.helper.resources.limits.memory         | [Memory limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-helper` container.                                                                                                                                                                                                                                                                                |
| init-iptables-cpu                   | config.sidecar.initContainers.iptables.resources.requests.cpu    | [Requested CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-iptables` container.                                                                                                                                                                                                                                                                        |
| init-iptables-memory                | config.sidecar.initContainers.iptables.resources.requests.memory | [Requested memory](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-iptables` container..                                                                                                                                                                                                                                                                     |
| init-iptables-cpu-limit             | config.sidecar.initContainers.iptables.resources.limits.cpu      | [CPU limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-iptables` container..                                                                                                                                                                                                                                                                            |
| init-iptables-memory-limit          | config.sidecar.initContainers.iptables.resources.limits.memory   | [Memory limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-iptables` container.                                                                                                                                                                                                                                                                         |
| init-helper-cpu                     | config.sidecar.initContainers.helper.resources.requests.cpu      | [Requested CPU](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-helper` container.                                                                                                                                                                                                                                                                          |
| init-helper-memory                  | config.sidecar.initContainers.helper.resources.requests.memory   | [Requested memory](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-helper` container.                                                                                                                                                                                                                                                                       |
| init-helper-cpu-limit               | config.sidecar.initContainers.helper.resources.limits.cpu        | [CPU limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-helper` container.                                                                                                                                                                                                                                                                              |
| init-helper-memory-limit            | config.sidecar.initContainers.helper.resources.limits.memory     | [Memory limit](customization.md#per-pod-basis-allocation-via-pods-annotations) for the `sidecar-init-helper` container.                                                                                                                                                                                                                                                                           |

There are more [NGINX directives supported by Wallarm](../../../admin-en/configure-parameters-en.md) that are not covered by direct annotations. Nevertheless, you can configure them as well using the `nginx-*-snippet` annotation.

## How to use annotations

To apply annotation to a pod, specify it in the `Deployment` object settings of the appropriate application config, e.g.:

```yaml hl_lines="17"
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
        wallarm-sidecar: enabled
      annotations:
        sidecar.wallarm.io/wallarm-mode: block
    spec:
      containers:
        - name: application
          image: kennethreitz/httpbin
          ports:
            - name: http
              containerPort: 80
```
